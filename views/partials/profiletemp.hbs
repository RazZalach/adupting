
<style>
  .sim{
    border: 4px solid rgb(0, 0, 0);
    border-radius: 8%;
    background-color:blanchedalmond;
    margin-left: 15%;
 
  }
  .raz{
   
       text-align: center;
    text-align: justify;
    margin-left: 10%;
  }
  .raz h6{
   
    font-style: italic;
    font-size: 16px;
  }
  .raz button{
    border-radius: 4px;
  }
</style>
<div class="container bootstrap snippet" >
  <div style="display: flex; ">
    <div class="row">
  		<div id="img" class="col-sm-10"><h1 style="color: blue;">שלום {{name}} {{lastname}}</h1></div>      
    </div>
    <script>
 
         const userid = sessionStorage.getItem('uid'); 

      const input1 =  `<img style="border-radius: 10%;" src="/images/${userid}.jpg" alt="" height="200px" width="200px"> `;
    document.getElementById('img').innerHTML += input1;
    </script>
    <div class="sim">
  <div class="tab-content" >    
            <div class="tab-pane active" id="stage1" style=" display: none; ">
              <div class="raz">
               <h3>שלב 1</h3> 
                      <div class="form-group">
                        <h1> מצב סוציו-אקונומי</h1>
                          <div class="col-xs-6">
                            <h6> עליך לבחור כמה אתה מרוויח במומצע בכל חודש מבין האפשרויות לפניך</h6>
                           <br>
                          <input type="radio" id="salary1" name="salary" value="5000-7000">
                            <label for="salary1"> 5,000-7,000 </label><br>
                            <input type="radio" id="salary2" name="salary" value="7000-10000">
                            <label for="salary2">7,000-10,000 </label><br>
                            <input type="radio" id="salary3" name="salary" value="10000-12000">
                            <label for="salary3"> 10,000-12,000 </label><br>
                                <button class="button" onclick="save_salary()"> שמור</button>
                          </div>
                      </div>
             <!--/tab-pane-->
            </div>
                </div>
             <div class="tab-pane" id="stage2" style="display: none; margin-left: 30%;" >
              <div class="raz">
             <h2 >שלב 2</h2> <br>
            <h6>בשלב זה עליך לבחור את הלאום אליו אתה משתייך </h6>
              <h5>הלאום שלך:</h5> 
                <div class="col-md-12">
                    <select style="width: 150px;" id="region">
                      <option value=""> בחר לאום</option>
                      <option value="יהודי">יהודי</option>
                      <option value="מוסלמי">מוסלמי</option>
                      <option value="נוצרי">נוצרי</option>
                    </select>
                </div>
          <br>
          <br>
              <button class="button" onclick="save_region()">שמור</button>
               
            </div>
        
               
             </div><!--/tab-pane-->
         
             <div class="tab-pane" id="stage3" style="display: none;">	
              <div class="raz">
                <h1 >שלב העלאת נתונים</h1>
               	<h5>שלב העלאת צילום תעודת זהות </h5> 
                <p>שים לב שצילום תעודת הזהות חשוב למערכת כדי לאמת את הנתונים שלך 
                  <br>
                  שים לב שהתמונה באיכות וברורה 
                </p>
                  <hr>
      
           <form action="/upload" method="post" enctype="multipart/form-data">
           <script> 
            const profileid = sessionStorage.getItem('proid'); 
         const userid2 = sessionStorage.getItem('uid');
            var fname = userid2 + "_" + profileid +"_1";
            const input2 = `<input type="hidden" value="${fname}" id="filename" name="filename" >`;
              document.querySelector('form').innerHTML += input2;
           </script>
            <input type="file" name="files" class="btn btn-primary" id="file1" onchange="checkFile('file1')"  multiple><br>

            
            <button class="btn btn-primary" type="submit"  onclick="return checkFile('file1')">
                העלה תעודת זהות
            </button>

        </form>
</div>
   
           
              </div>

                <div class="tab-pane" id="stage4" style="display: none;">
                  <div class="raz">
                  <h1 >שלב העלאת נתונים</h1>
                       	<h5>שלב העלאת תלוש משכורת </h5> 
                <p >שים לב שמסמך תלוש המשכורת מהווה אימות לשכר אותו אתה מרוויח במומצע בחודש 
                  <br>
                  שים לב שהקובץ קריא ואמין 
                </p>
                  <h6> עליך לספק מסמך כמו תלוש משכורת או כל מסמך אחר שיתן תמונת מצב בנוגע לרקע הכלכלי שלך </h6>
      
           <form id="form2" action="/upload" method="post" enctype="multipart/form-data">
     
           <script> 
            
                 const profileid3 = sessionStorage.getItem('proid'); 
         const userid3 = sessionStorage.getItem('uid');
            var fname2 = userid3 + "_" + profileid3 +"_2";
         
          
            const input3 = `<input type="hidden" value="${fname2}" id="filename" name="filename" >`;
              document.getElementById('form2').innerHTML += input3;
           </script>
            <input type="file" name="files" class="btn btn-primary" id="file2" onchange="checkFile('file2')" multiple><br>
            
            <button class="btn btn-primary" type="submit" style="border-radius: 4px;" onclick="return checkFile('file2')">
             העלאת קובץ
            </button>
        </form>
        </div>
                </div>

                <div class="tab-pane" id="stage5" style="display: none;">
                  <div class="raz">
                   <h1 >שלב העלאת נתונים</h1>
                <h5>שלב העלאה רקע פלילי </h5> 
                <p>שים לב שמסמך רקע פלילי מהווה אימות  
                  <br>
                  שים לב שהקובץ קריא ואמין 
                </p>
                  <hr>
                  <form id="form3" action="/upload" method="post" enctype="multipart/form-data">
                   <script> 
            
                 const profileid4 = sessionStorage.getItem('proid'); 
         const userid4 = sessionStorage.getItem('uid');
            var fname4 = userid4 + "_" + profileid4 +"_3";
         
          
            const input4 = `<input type="hidden" value="${fname4}" id="filename" name="filename" >`;
              document.getElementById('form3').innerHTML += input4;
           </script>
            <input type="file" name="files" class="btn btn-primary" id="file3" onchange="checkFile('file3')" multiple><br>
            
            <button class="btn btn-primary" type="submit" style="border-radius: 4px;" onclick="return checkFile('file3')">
             העלאת קובץ
            </button>
                  
                  
                  
                  </form>
    


            </div>
                </div>

               <div class="tab-pane" id="stage6" style="display: none;">
          
               
                    <h1>{{name}} {{lastname}} שים לב !!</h1>
                    <p style="font-size: larger; font-weight:bold; ">הפרופיל שלך כרגע בשלבי אימות!
כעת מנהל המערכת בוחן את הנתונים שהתקבלו במידה והפרופיל שלך יאושר
תקבל מייל בהתאם וקישור לחזרה להתקדמות בשלבי האימות
אנא התעדכן במייל מעת לעת </p>
                    <a class="button" style="text-decoration: none; color:white" href="/about#contact">צור קשר במידה ומשהו לא ברור</a>
                    </div>
                  </div>
 
  </div> 
    </div>
    
  <div class="row">
  		<div class="col-sm-3"><!--left col-->
      <div class="text-center">
      </div></hr> <br>  <br>  <br>
          <ul class="list-group" style="direction: rtl;">
            <li  class="list-group-item text-muted" ><h5 style="color: cornflowerblue;">מצב הפרופיל</h5></li>
            <li class="list-group-item text-right"><span class="pull-left"><strong>סטטוס</strong></span>  {{status}}</li>
            <li class="list-group-item text-right"><span class="pull-left"><strong>כתובת מייל</strong></span> {{email}}</li>
            <li class="list-group-item text-right"><span class="pull-left"><strong>טלפון</strong></span> {{phone}} </li>
            <li class="list-group-item text-right"><span class="pull-left"><strong>עיר</strong></span>  {{city}}</li>
            <li class="list-group-item text-right"><span class="pull-left"><strong>תאריך לידה</strong></span> {{d_of_birth}} </li>
        
          </ul>
          <br>  <br>
        </div><!--/col-3-->
     
  
   
  </section>
    </div>

                
</div>

   
      <script>
                function checkFile(name) {
                  if (document.getElementById(name).value == "") {
                      alert("נא לבחור קובץ להעלאה");
                      return false;
                  }
                }
            </script>
 
<script>
var proid = sessionStorage.getItem("proid");
var myHeaders = new Headers();
myHeaders.append("Content-Type", "application/x-www-form-urlencoded");
var urlencoded = new URLSearchParams();
urlencoded.append("profileid", proid);
var requestOptions = {
  method: 'POST',
  headers: myHeaders,
  body: urlencoded,
  redirect: 'follow'
};

fetch("/prof/getbyid", requestOptions).then((res)=>{ return res.json()}).then((data)=>{ 

        sessionStorage.setItem("status",data.msg.status );
    if(data.msg.status == 1){
     
        document.getElementById("stage1").style.display = "block";
    }
      if(data.msg.status == 2){
        document.getElementById("stage2").style.display = "block";
    }
      if(data.msg.status == 3){
        document.getElementById("stage3").style.display = "block";
    }
      if(data.msg.status == 4){
        document.getElementById("stage4").style.display = "block";
    }
         if(data.msg.status == 5){
        document.getElementById("stage5").style.display = "block";
    }
      if(data.msg.status == 6){
        document.getElementById("stage6").style.display = "block";
    }
    
});



</script>

<script>
    function save_salary(){
        var myHeaders1 = new Headers();
        myHeaders1.append("Content-Type", "application/x-www-form-urlencoded");

        var urlencoded1 = new URLSearchParams();
       var options = document.getElementsByName("salary");
         for (i = 0; i < options.length; i++) {
          if (options[i].checked) {
             urlencoded1.append("salary",options[i].value);
            break;
          }
      }
       
        urlencoded1.append("profileid", sessionStorage.getItem("proid"));

        var requestOptions1 = {
        method: 'POST',
        headers: myHeaders1,
        body: urlencoded1,
        redirect: 'follow'
        };

    fetch("/prof/salary", requestOptions1).then((res)=>{ return res.json()}).then((data)=>{ 
        
    });
    rundecision(); 

    }
    </script>
    <script>
    function save_region(){
const region = document.getElementById("region").value;
var myHeaders2 = new Headers();
myHeaders2.append("Content-Type", "application/x-www-form-urlencoded");

var urlencoded2 = new URLSearchParams();
urlencoded2.append("region", region);
urlencoded2.append("profileid", sessionStorage.getItem("proid"));

var requestOptions2 = {
  method: 'POST',
  headers: myHeaders2,
  body: urlencoded2,
  redirect: 'follow'
};


    fetch("/prof/region", requestOptions2).then((res)=>{ return res.json()}).then((data)=>{ 
        
    });
        rundecision();
    
 
    }
</script>
<script>

    function rundecision(){
  
        var myHeaders3 = new Headers();
        myHeaders3.append("Content-Type", "application/x-www-form-urlencoded");

        var urlencoded3 = new URLSearchParams();
        urlencoded3.append("decisionid", "sr4hhz4");
        urlencoded3.append("profileid", sessionStorage.getItem("proid"));

        var requestOptions3 = {
        method: 'POST',
        headers: myHeaders3,
        body: urlencoded3,
        redirect: 'follow'
        };

        fetch("/decision/run_manualy", requestOptions3).then((res)=>{ return res.json()}).then((data)=>{

                     var myHeaders4 = new Headers();
            myHeaders4.append("Content-Type", "application/x-www-form-urlencoded");
            var urlencoded4 = new URLSearchParams();
                urlencoded4.append("operation", "machine-decision: sr4hhz4 --change status to profile ");
                urlencoded4.append("request", `from status: ${sessionStorage.getItem("status")} excute status change with profile id : ` +sessionStorage.getItem("proid"));
                urlencoded4.append("deviceinfo", window.navigator.userAgent);
                urlencoded4.append("response", JSON.stringify(data.msg));
            var requestOptions4 = {
              method: 'POST',
              headers: myHeaders4,
              body: urlencoded4,
              redirect: 'follow'
            };
        fetch("/logs/slog", requestOptions4).then((res)=>{ return res.json()}).then((datalog)=>{ })
         })
         if(sessionStorage.getItem("status") != 4){
          setTimeout(()=>{window.location.reload();},1000);
         }
        
           
    }
</script>

 <script>
            $(document).ready(function() {

    
    var readURL = function(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                //mycode!!
                $('.avatar').attr('src', e.target.result);
            }
    
            reader.readAsDataURL(input.files[0]);
        }
    }
    

    $(".file-upload").on('change', function(){
        readURL(this);
    });
});
</script>    
 
