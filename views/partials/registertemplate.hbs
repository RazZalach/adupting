<!-- ייבוא ספריית jQuery UI -->
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

<!-- ייבוא ספריית ה־CSS של jQuery UI -->
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	 {{>homepage}}
	 <div class="container login__container my-5">
        <div class="row login__row">
            <div class="col-md-6 d-flex">
                <img class="login__imagek align-self-center" src="https://www.freevector.com/uploads/vector/preview/28488/Businessman_Happy_Accepting_News.jpg"
                    width="100%" alt="" />
            </div>
            <div class="col-md-5 d-flex">
                <div class="align-self-center card login__card shadow-sm w-100">
                    <div class="card-body">
                 
                            <h2 class="text-muted text-center">דף הרשמה</h2>
                       
                            <div class="">
                                <div style=" direction: rtl;" class="form-group">
                                    <label style=" direction: rtl;" for="">אימייל:</label>
                                    <input id="email" type="email" class="form-control form-control-lg" pattern="[^ @]*@[^ @]*"  placeholder="הכנס את האימייל שלך" required>
                                </div>
                                <div style=" direction: rtl;" class="form-group">
                                    <label style=" direction: rtl;" for="">שם פרטי</label>
                                     <input  id="name" type="text" class="form-control form-control-lg" name="fullname" placeholder="שם מלא" title=""required >
                                </div>
                                   <div style=" direction: rtl;" class="form-group">
                                    <label style=" direction: rtl;" for="">שם משפחה</label>
                                     <input  id="lastname" type="text" class="form-control form-control-lg" name="fullname" placeholder="שם מלא" title=""required >
                                </div>
                                
                                   <div style=" direction: rtl;" class="form-group">
                                    <label style=" direction: rtl;" for="">עיר</label>
                                     {{!-- <select id="city" class="form-control form-control-lg" name="city" placeholder=" עיר" title=""required >

                                     </select> --}}
                                     <select id="city" name="city" class="form-control form-control-lg" >
                                    <option value="">בחר עיר</option>
                                    </select>
                                </div>
                                    <div style=" direction: rtl;" class="form-group">
                                    <label style=" direction: rtl;" for="">כתובת</label>
                                     <input  id="address" type="text" class="form-control form-control-lg" name="address" placeholder=" כתובת" title="" required>
                                </div>
                                <div style=" direction: rtl;" class="form-group">
                                    <label style=" direction: rtl;" for="">טלפון נייד</label>
                                     <input  id="phone" type="text" class="form-control form-control-lg" pattern="/^0\d([\d]{0,1})([-]{0,1})\d{7}$/" name="phone" placeholder=" טלפון" title=""required >
                                </div>
                                    <div style=" direction: rtl;" class="form-group">
                                      <div class="col-md-12"><label class="labels">תאריך לידה</label><input id="Bdate" type="date" class="form-control form-control-lg" placeholder="תאריך לידה" required ></div>
                                     
                                </div>
                                   <div style=" direction: rtl;" class="form-group">
                                    <label style=" direction: rtl;" for="">סיסמה:</label>
                                     <input  id="psw" type="password" class="form-control form-control-lg" name="psw" placeholder="הכנס את הסיסמה" title="חייב להכיל לפחות ספרה אחת ואות גדולה וקטנה אחת, ולפחות 8 תווים או יותר" required>
                                </div>
                              
                                <div class="form-group">
									 <button class="btn btn-primary btn-lg btn-block my-3" onclick="validatePassword()"> הרשמה</button>
                                  
                                    <div class="d-flex justify-content-between">
                                  
                                      
                                    </div>
                                 
                                </div>
								<div style=" direction: rtl;" id="message">
  <h3 style=" direction: rtl;">הסיסמה חייבת להכיל את הדברים הבאים:</h3>
  <p  id="letter" class="invalid"><b >אותיות קטנות</b></p>
  <p id="capital" class="invalid"><b>אותיות רישיות</b></p>
  <p id="number" class="invalid"><b>מספר</b></p>
  <p id="length" class="invalid">מִינִימוּם <b>8 תווים</b></p>
</div> 
                            </div>
                  
                    </div>
                </div>
            </div>
        </div>
    </div>
     {{>footertemp}}
    
<script>
var requestOptions = {
  method: 'GET',
  redirect: 'follow'
};


fetch("https://data.gov.il/api/3/action/datastore_search?resource_id=1b14e41c-85b3-4c21-bdce-9fe48185ffca&limit=10000000")
  .then(response => response.json())
  .then(data => {
    // המרת הנתונים מתוך ה-API למערך שמכיל רק את city_name
 const newCities = [];
// המרת הנתונים מתוך ה-API למערך שמכיל רק את city_name
  const cities = data.result.records.map(record => {
  if (!newCities.includes(record.city_name)) {
    newCities.push(record.city_name);
    return record.city_name;
  }
  return '';
  });

    const cityInput = document.getElementById("city");
    const collator = new Intl.Collator('he');
    cities.sort(collator.compare);
    cities.forEach(city => {
      if(city.length  > 0){
      const option = document.createElement("option");
     option.value = city;
     option.text = city;
     cityInput.appendChild(option);
      }
    });
  });


    // עדכון תיבת הקלט עם הערים החדשות
    


</script>
<script>
      $(function() {
  // קריאה ל־autocomplete על־תיבת ה־select
  $("#city").autocomplete({
    source: cities // מערך הערים המקורי
  });
</script>

	 <script>
    var bool1 =false;
    var bool2 = false;
     var bool3 = false;
      var bool4 = false;
var myInput = document.getElementById("psw");
var letter = document.getElementById("letter");
var capital = document.getElementById("capital");
var number = document.getElementById("number");
var length = document.getElementById("length");

// When the user clicks on the password field, show the message box
myInput.onfocus = function() {
  document.getElementById("message").style.display = "block";
}

// When the user clicks outside of the password field, hide the message box
myInput.onblur = function() {
  document.getElementById("message").style.display = "none";
}

// When the user starts to type something inside the password field
myInput.onkeyup = function() {
  // Validate lowercase letters
  var lowerCaseLetters = /[a-z]/g;
  if(myInput.value.match(lowerCaseLetters)) {
    letter.classList.remove("invalid");
    letter.classList.add("valid");
    bool1 = true; 
  } else {
    letter.classList.remove("valid");
    letter.classList.add("invalid");
}

  // Validate capital letters
  var upperCaseLetters = /[A-Z]/g;
  if(myInput.value.match(upperCaseLetters)) {
    capital.classList.remove("invalid");
    capital.classList.add("valid");
    bool2 = true ;
  } else {
    capital.classList.remove("valid");
    capital.classList.add("invalid");
  }

  // Validate numbers
  var numbers = /[0-9]/g;
  if(myInput.value.match(numbers)) {
    number.classList.remove("invalid");
    number.classList.add("valid");
    bool3 = true; 
  } else {
    number.classList.remove("valid");
    number.classList.add("invalid");
  }

  // Validate length
  if(myInput.value.length >= 8) {
    length.classList.remove("invalid");
    length.classList.add("valid");
    bool4 = true;
  } else {
    length.classList.remove("valid");
    length.classList.add("invalid");
  }
}
</script>
<script>
             const  name=document.getElementById("name").value;
             const  lastname=document.getElementById("lastname").value;
              const  city=document.getElementById("city").value;
              const  address=document.getElementById("address").value;
              const  phone=document.getElementById("phone").value;
             const Email=document.getElementById("email").value;
             const password=document.getElementById("psw").value;
             
function validatePassword(){



if (bool1 && bool2 && bool3 && bool4){
   register()
}
   else {
  
    alert("validation not match");
  }
}

password.onchange = validatePassword;

</script> 

 <script>

  function register()
        { 
         
          var str="";
          var userip="";
           var Bdate = document.getElementById("Bdate").value;   
             const  Name=document.getElementById("name").value;
             const  Lastname=document.getElementById("lastname").value;
              var  City=document.getElementById("city").value;
              const  Address=document.getElementById("address").value;
              const  Phone=document.getElementById("phone").value;
             const Email=document.getElementById("email").value;
             const Password=document.getElementById("psw").value;
             City = City.trim();
             fetch('/user/reg',{
                    method: 'POST',
                    body:new URLSearchParams({
                    name:Name,
                    lastname:Lastname,
                    email:Email,
                    phone:Phone,
                    city:City,
                    address:Address,
                    d_of_birth:Bdate,
                    userpassword:Password
                     })
              
                }).then((res)=>{ 
                    return res.json()}).then((data)=>{ 
               
        
            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/x-www-form-urlencoded");
            var urlencoded = new URLSearchParams();
                urlencoded.append("operation", "Register");
                urlencoded.append("request", Name+" "+Lastname+" excute registration with email : " +Email);
                urlencoded.append("deviceinfo", window.navigator.userAgent);
                urlencoded.append("response", JSON.stringify(data));
            var requestOptions = {
              method: 'POST',
              headers: myHeaders,
              body: urlencoded,
              redirect: 'follow'
            };

fetch("/logs/slog", requestOptions).then((res)=>{ return res.json()}).then((data)=>{ alert(data.msg)})

             if(data.msg != 1){
                alert("email already exist");
                 window.location.replace('/register');
               }
               else{
               alert("seccesfully registration");
               window.location.replace('/login');
               }
                                            
                     })

        }
  
   
 
    </script>